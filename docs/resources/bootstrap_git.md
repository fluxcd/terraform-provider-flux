---
page_title: "flux_bootstrap_git Resource - terraform-provider-flux"
subcategory: ""
description: |-
  Commits Flux components to a Git repository and configures a Kubernetes cluster to synchronize with the same Git repository.
---

# flux_bootstrap_git (Resource)

Commits Flux components to a Git repository and configures a Kubernetes cluster to synchronize with the same Git repository.

~> **NOTE:** This resource is still under development and may receive breaking attribute changes. Use with care in a production environment.

## Example Usage

Get Kubernetes credentials from a kubeconfig file. The current context set in the kubeconfig file will be used by default.

```terraform
resource "flux_bootstrap_git" "this" {
  url  = var.repository_ssh_url
  path = "clusters/my-cluster"
  ssh = {
    username    = "git"
    private_key = var.private_key_pem
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `url` (String) Url of git repository to bootstrap from.

### Optional

- `author_email` (String) Author email for Git commits.
- `author_name` (String) Author name for Git commits.
- `branch` (String) Branch in repository to reconcile from.
- `cluster_domain` (String) The internal cluster domain.
- `commit_message_appendix` (String) String to add to the commit messages.
- `components` (Set of String) Toolkit components to include in the install manifests.
- `components_extra` (Set of String) List of extra components to include in the install manifests.
- `gpg_key_id` (String) Key id for selecting a particular key.
- `gpg_key_ring` (String) GPG key ring for signing commits.
- `gpg_passphrase` (String, Sensitive) Passphrase for decrypting GPG private key.
- `http` (Attributes) (see [below for nested schema](#nestedatt--http))
- `image_pull_secret` (String) Kubernetes secret name used for pulling the toolkit images from a private registry.
- `interval` (String) Interval at which to reconcile from bootstrap repository.
- `kustomization_override` (String) Kustomization to override configuration set by default.
- `log_level` (String) Log level for toolkit components.
- `namespace` (String) The namespace scope for install manifests.
- `network_policy` (Boolean) Deny ingress access to the toolkit controllers from other namespaces using network policies.
- `path` (String) Path relative to the repository root, when specified the cluster sync will be scoped to this path.
- `recurse_submodules` (Boolean) Configures the GitRepository source to initialize and include Git submodules in the artifact it produces.
- `registry` (String) Container registry where the toolkit images are published.
- `secret_name` (String) Name of the secret the sync credentials can be found in or stored to.
- `ssh` (Attributes) (see [below for nested schema](#nestedatt--ssh))
- `toleration_keys` (Set of String) List of toleration keys used to schedule the components pods onto nodes with matching taints.
- `version` (String) Flux version.
- `watch_all_namespaces` (Boolean) If true watch for custom resources in all namespaces.

### Read-Only

- `id` (String) The ID of this resource.
- `repository_files` (Map of String) Git repository files created and managed by the provider.

<a id="nestedatt--http"></a>
### Nested Schema for `http`

Optional:

- `allow_insecure_http` (Boolean) Allows http Git url connections.
- `certificate_authority` (String) Certificate authority to validate self-signed certificates.
- `password` (String, Sensitive) Password for basic authentication.
- `username` (String) Username for basic authentication.


<a id="nestedatt--ssh"></a>
### Nested Schema for `ssh`

Optional:

- `password` (String, Sensitive) Password for private key.
- `private_key` (String, Sensitive) Private key used for authenticating to the Git SSH server.
- `username` (String) Username for Git SSH server.

### Customizing Flux

The Flux controller deployments, container command arguments, node affinity, etc can be customized using [Kustomize strategic merge patches and JSON patches](https://github.com/kubernetes-sigs/kustomize/blob/master/examples/patchMultipleObjects.md).
The Kustomize file is configured through the `kustomize_override` argument. Below are some examples of use cases when customizing Flux is useful, refer to the [customization examples documentation](https://github.com/kubernetes-sigs/kustomize/blob/master/examples/patchMultipleObjects.md) for more examples.

```terraform
resource "flux_bootstrap_git" "this" {
  url  = var.repository_ssh_url
  path = "clusters/my-cluster"
  ssh = {
    username    = "git"
    private_key = var.private_key_pem
  }
  kustomization_override = file("${path.module}/kustomization.yaml")
}
```

#### Safe to evict

Allow the cluster autoscaler to evict the Flux controller pods.

```yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - gotk-components.yaml
  - gotk-sync.yaml
patches:
  - patch: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: all
      spec:
        template:
          metadata:
            annotations:
              cluster-autoscaler.kubernetes.io/safe-to-evict: "true"      
    target:
      kind: Deployment
      labelSelector: app.kubernetes.io/part-of=flux
```

#### Node affinity and tolerations

Pin the Flux controllers to specific nodes.

```yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - gotk-components.yaml
  - gotk-sync.yaml
patches:
  - patch: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: all
      spec:
        template:
          spec:
            affinity:
              nodeAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                  nodeSelectorTerms:
                    - matchExpressions:
                        - key: role
                          operator: In
                          values:
                            - flux
            tolerations:
              - effect: NoSchedule
                key: role
                operator: Equal
                value: flux      
    target:
      kind: Deployment
      labelSelector: app.kubernetes.io/part-of=flux
```

## Import

Existing Flux installations can be imported by passing the namespace where Flux is installed.

```sh
terraform import flux_bootstrap_git.this flux-system
```
