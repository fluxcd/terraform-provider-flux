---
page_title: "flux_bootstrap_git Resource - terraform-provider-flux"
subcategory: ""
description: |-
  Commits Flux components to a Git repository and configures a Kubernetes cluster to synchronize with the same Git repository.
---

# flux_bootstrap_git (Resource)

Commits Flux components to a Git repository and configures a Kubernetes cluster to synchronize with the same Git repository.

-> **NOTE:** Checkout the [GitHub](https://registry.terraform.io/providers/fluxcd/flux/latest/docs/guides/github) or [Gitlab](https://registry.terraform.io/providers/fluxcd/flux/latest/docs/guides/gitlab) bootstrap guide for a detailed step by step guide.

## Example Usage

Get Kubernetes credentials from a kubeconfig file. The current context set in the kubeconfig file will be used by default.

```terraform
resource "flux_bootstrap_git" "this" {
  path = "clusters/my-cluster"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `cluster_domain` (String) The internal cluster domain. Defaults to `cluster.local`
- `components` (Set of String) Toolkit components to include in the install manifests. Defaults to `[source-controller kustomize-controller helm-controller notification-controller]`
- `components_extra` (Set of String) List of extra components to include in the install manifests.
- `disable_secret_creation` (Boolean) Use the existing secret for flux controller and don't create one from bootstrap
- `image_pull_secret` (String) Kubernetes secret name used for pulling the toolkit images from a private registry.
- `interval` (String) Interval at which to reconcile from bootstrap repository. Defaults to `1m0s`.
- `kustomization_override` (String) Kustomization to override configuration set by default.
- `log_level` (String) Log level for toolkit components. Defaults to `info`.
- `manifests_path` (String) The install manifests are built from a GitHub release or kustomize overlay if using a local path. Defaults to `https://github.com/fluxcd/flux2/releases`.
- `namespace` (String) The namespace scope for install manifests. Defaults to `flux-system`. It will be created if it does not exist.
- `network_policy` (Boolean) Deny ingress access to the toolkit controllers from other namespaces using network policies. Defaults to `true`.
- `path` (String) Path relative to the repository root, when specified the cluster sync will be scoped to this path.
- `recurse_submodules` (Boolean) Configures the GitRepository source to initialize and include Git submodules in the artifact it produces.
- `registry` (String) Container registry where the toolkit images are published. Defaults to `ghcr.io/fluxcd`.
- `secret_name` (String) Name of the secret the sync credentials can be found in or stored to. Defaults to `flux-system`.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))
- `toleration_keys` (Set of String) List of toleration keys used to schedule the components pods onto nodes with matching taints.
- `version` (String) Flux version. Defaults to `v2.2.3`.
- `watch_all_namespaces` (Boolean) If true watch for custom resources in all namespaces. Defaults to `true`.

### Read-Only

- `id` (String) The ID of this resource.
- `repository_files` (Map of String) Git repository files created and managed by the provider.

<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
- `delete` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs.
- `read` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Read operations occur during any refresh or planning operation when refresh is enabled.
- `update` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).

### Customizing Flux

The Flux controller deployments, container command arguments, node affinity, etc can be customized using [Kustomize strategic merge patches and JSON patches](https://github.com/kubernetes-sigs/kustomize/blob/master/examples/patchMultipleObjects.md).
The Kustomize file is configured through the `kustomize_override` argument. Below are some examples of use cases when customizing Flux is useful, refer to the [customization examples documentation](https://github.com/kubernetes-sigs/kustomize/blob/master/examples/patchMultipleObjects.md) for more examples.

```terraform
resource "flux_bootstrap_git" "this" {
  path                   = "clusters/my-cluster"
  kustomization_override = file("${path.module}/kustomization.yaml")
}
```

#### Safe to evict

Allow the cluster autoscaler to evict the Flux controller pods.

```yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - gotk-components.yaml
  - gotk-sync.yaml
patches:
  - patch: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: all
      spec:
        template:
          metadata:
            annotations:
              cluster-autoscaler.kubernetes.io/safe-to-evict: "true"
    target:
      kind: Deployment
      labelSelector: app.kubernetes.io/part-of=flux
```

#### Node affinity and tolerations

Pin the Flux controllers to specific nodes.

```yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - gotk-components.yaml
  - gotk-sync.yaml
patches:
  - patch: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: all
      spec:
        template:
          spec:
            affinity:
              nodeAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                  nodeSelectorTerms:
                    - matchExpressions:
                        - key: role
                          operator: In
                          values:
                            - flux
            tolerations:
              - effect: NoSchedule
                key: role
                operator: Equal
                value: flux
    target:
      kind: Deployment
      labelSelector: app.kubernetes.io/part-of=flux
```

## Import

Existing Flux installations can be imported by passing the namespace where Flux is installed.

```sh
terraform import flux_bootstrap_git.this flux-system
```
